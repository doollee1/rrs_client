<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.doollee.service.impl.DlMapper">
    <select id="listMain" resultType="com.doollee.service.vo.MainNoticeVO">
	    SELECT wr_id
		     , wr_subject
		     , SUBSTR(wr_datetime, 1, 10) AS wr_date
		  FROM g4_write_notice
		 ORDER BY wr_id DESC LIMIT 0, 2
	</select>
	
	<select id="list" resultType="com.doollee.service.vo.MainNoticeVO">
        SELECT wr_id
		     , wr_subject
		     , SUBSTR(wr_datetime, 1, 10) AS wr_date
		  FROM g4_write_notice
		 ORDER BY wr_id DESC 
 	</select>
 	
 	<!-- 공지사항 목록 -->
 	<select id="noticeList"  parameterType="hashMap" resultType="hashMap">
        SELECT wr_id
			 , wr_subject
			 , SUBSTR(wr_datetime, 1, 10) AS wr_date
		  FROM g4_write_notice
		 ORDER BY wr_id DESC 
	      LIMIT #{page},10
 	</select>
 	
 	<!-- 공지사항 전체목록 -->
 	<select id="noticeListCnt" resultType="int">	
        SELECT count(*) AS cnt
		  FROM g4_write_notice
 	</select>
 	
 	<!-- 공지사항 상세 -->
 	<select id="noticeDetail" parameterType="hashMap" resultType="hashMap">
        SELECT wr_id
		     , wr_subject
		     , wr_content
		     , wr_name
		     , wr_datetime
		  FROM g4_write_notice
		 WHERE wr_id = #{wr_id}
 	</select>
 	
 	<!-- 공지사항 등록 -->
 	<insert id="noticeIns" parameterType="hashMap">
        <selectKey resultType="integer" keyProperty="wr_id" order="BEFORE">
            SELECT IFNULL(MAX(wr_id), 0)+1  FROM g4_write_notice
        </selectKey>
        INSERT INTO g4_write_notice(
               wr_id
             , ca_name
             , wr_subject
             , wr_content
             , wr_hit
             , mb_id
             , wr_name
             , wr_email
             , wr_dateTime
             , wr_last
             , wr_ip
        ) VALUES(
               #{wr_id}
             , ''
             , #{wr_subject}
             , #{wr_content}
             , 0
             , #{sessionId}
             , #{sessionName}
             , ''
             , NOW()
             , NOW()
             , ''
        )
        
 	</insert>
 	
 	<!-- 공지사항  조회수 업데이트 -->
 	<update id="noticeHitUpd" parameterType="hashMap">
        UPDATE g4_write_notice
           SET wr_hit = wr_hit+1
         WHERE wr_id  = #{wr_id}
 	</update>
 	
 	<!-- 공지사항  수정 -->
 	<update id="noticeUpd" parameterType="hashMap">
        UPDATE g4_write_notice
           SET wr_subject = #{wr_subject}
             , wr_content = #{wr_content}
             , wr_last    = NOW()
         WHERE wr_id = #{wr_id}
 	</update>
 	
 	<!-- 공지사항 삭제 -->
 	<delete id="noticeDel" parameterType="hashMap">
        DELETE FROM g4_write_notice
         WHERE wr_id = ${wr_id}
    </delete>
 	
</mapper>